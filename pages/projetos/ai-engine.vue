<template>
  <div class="min-h-screen bg-gray-950 text-gray-100">
    <!-- Header -->
    <header class="border-b border-gray-800 bg-gray-950/80 backdrop-blur-sm sticky top-0 z-50">
      <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
        <NuxtLink to="/" class="text-emerald-400 hover:text-emerald-300 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
          </svg>
          Voltar
        </NuxtLink>
        <span class="text-gray-500 text-sm">Optimus AI Platform</span>
      </div>
    </header>

    <!-- Hero Section -->
    <section class="py-16 px-4 border-b border-gray-800">
      <div class="max-w-4xl mx-auto">
        <div class="flex items-center gap-3 mb-6">
          <span class="px-3 py-1 bg-emerald-500/20 text-emerald-400 rounded-full text-sm font-medium">
            Core Service
          </span>
          <span class="px-3 py-1 bg-gray-800 text-gray-400 rounded-full text-sm">
            Arquitetura de IA
          </span>
        </div>
        
        <h1 class="text-4xl md:text-5xl font-bold mb-6">
          AI Conversation
          <span class="text-emerald-400"> Engine</span>
        </h1>
        
        <p class="text-xl text-gray-400 mb-8 leading-relaxed">
          Motor de conversaÃ§Ã£o enterprise que separa lÃ³gica determinÃ­stica de linguagem natural. 
          LangGraph orquestra 20+ nÃ³s especializados, FSM de 8 estados garante comportamentos 
          crÃ­ticos, e Semantic Router decide em &lt;10ms quando o LLM pode ser bypassado.
        </p>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-4 text-center">
            <div class="text-2xl font-bold text-emerald-400">20+</div>
            <div class="text-sm text-gray-500">NÃ³s LangGraph</div>
          </div>
          <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-4 text-center">
            <div class="text-2xl font-bold text-emerald-400">8</div>
            <div class="text-sm text-gray-500">Estados FSM</div>
          </div>
          <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-4 text-center">
            <div class="text-2xl font-bold text-emerald-400">&lt;10ms</div>
            <div class="text-sm text-gray-500">Semantic Routing</div>
          </div>
          <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-4 text-center">
            <div class="text-2xl font-bold text-emerald-400">99.9%</div>
            <div class="text-sm text-gray-500">Uptime</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Navigation -->
    <nav class="sticky top-16 z-40 bg-gray-950/90 backdrop-blur-sm border-b border-gray-800">
      <div class="max-w-4xl mx-auto px-4">
        <div class="flex gap-6 overflow-x-auto py-4 text-sm">
          <a href="#problema" class="text-gray-400 hover:text-emerald-400 whitespace-nowrap transition-colors">Problema</a>
          <a href="#arquitetura" class="text-gray-400 hover:text-emerald-400 whitespace-nowrap transition-colors">Arquitetura</a>
          <a href="#semantic-routing" class="text-gray-400 hover:text-emerald-400 whitespace-nowrap transition-colors">Semantic Routing</a>
          <a href="#fsm" class="text-gray-400 hover:text-emerald-400 whitespace-nowrap transition-colors">Booking FSM</a>
          <a href="#context-composer" class="text-gray-400 hover:text-emerald-400 whitespace-nowrap transition-colors">Context Composer</a>
          <a href="#fast-lane" class="text-gray-400 hover:text-emerald-400 whitespace-nowrap transition-colors">Pricing Fast Lane</a>
          <a href="#reducer" class="text-gray-400 hover:text-emerald-400 whitespace-nowrap transition-colors">Flow Reducer</a>
          <a href="#retry" class="text-gray-400 hover:text-emerald-400 whitespace-nowrap transition-colors">Retry Policies</a>
          <a href="#resultados" class="text-gray-400 hover:text-emerald-400 whitespace-nowrap transition-colors">Resultados</a>
        </div>
      </div>
    </nav>

    <!-- Content -->
    <main class="max-w-4xl mx-auto px-4 py-12">
      
      <!-- Problema -->
      <section id="problema" class="mb-16">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
          <span class="w-8 h-8 bg-red-500/20 rounded-lg flex items-center justify-center text-red-400">!</span>
          O Problema
        </h2>
        
        <div class="prose prose-invert max-w-none">
          <p class="text-gray-300 leading-relaxed mb-4">
            Chatbots baseados puramente em LLMs sofrem de um problema fundamental: 
            <strong class="text-white">nÃ£o-determinismo</strong>. O mesmo input pode gerar outputs 
            diferentes, e decisÃµes crÃ­ticas de negÃ³cio ficam Ã  mercÃª de "temperatura" e contexto 
            aleatÃ³rio.
          </p>
          
          <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-6 my-6">
            <h4 class="text-lg font-semibold text-gray-200 mb-4">CenÃ¡rios InaceitÃ¡veis</h4>
            <ul class="space-y-3 text-gray-400">
              <li class="flex items-start gap-3">
                <span class="text-red-400 mt-1">âœ—</span>
                <span><strong class="text-gray-200">"AlucinaÃ§Ã£o de horÃ¡rio":</strong> LLM confirma consulta Ã s 14h quando o usuÃ¡rio disse 15h. Paciente perde consulta, clÃ­nica perde receita.</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-red-400 mt-1">âœ—</span>
                <span><strong class="text-gray-200">"ConfirmaÃ§Ã£o ambÃ­gua":</strong> UsuÃ¡rio diz "ok", LLM interpreta como confirmaÃ§Ã£o. Mas era "ok, entendi" (acknowledgement), nÃ£o "ok, confirma".</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-red-400 mt-1">âœ—</span>
                <span><strong class="text-gray-200">"Intent drift":</strong> Conversa sobre preÃ§o vira agendamento sem o usuÃ¡rio pedir. LLM "ajudando demais".</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-red-400 mt-1">âœ—</span>
                <span><strong class="text-gray-200">"Loop infinito":</strong> LLM chama ferramenta, falha, chama de novo, falha... atÃ© timeout ou custo explodir.</span>
              </li>
            </ul>
          </div>

          <p class="text-gray-300 leading-relaxed">
            Para um sistema de agendamento mÃ©dico/odontolÃ³gico enterprise, isso Ã© inaceitÃ¡vel. 
            A soluÃ§Ã£o nÃ£o Ã© "melhorar o prompt" â€” Ã© separar o que precisa ser determinÃ­stico 
            (decisÃµes de negÃ³cio) do que pode ser probabilÃ­stico (geraÃ§Ã£o de linguagem natural).
          </p>
        </div>
      </section>

      <!-- Arquitetura -->
      <section id="arquitetura" class="mb-16">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
          <span class="w-8 h-8 bg-emerald-500/20 rounded-lg flex items-center justify-center text-emerald-400">ğŸ—ï¸</span>
          Arquitetura HÃ­brida
        </h2>

        <div class="prose prose-invert max-w-none">
          <p class="text-gray-300 leading-relaxed mb-6">
            O AI Engine implementa uma arquitetura hÃ­brida onde a <strong class="text-white">lÃ³gica de negÃ³cio 
            Ã© 100% determinÃ­stica</strong> (FSM + regras) e o LLM Ã© usado apenas para 
            <strong class="text-white">tarefas onde criatividade Ã© desejÃ¡vel</strong> (humanizaÃ§Ã£o, clarificaÃ§Ã£o).
          </p>

          <!-- Architecture Diagram -->
          <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-6 my-6">
            <h4 class="text-lg font-semibold text-gray-200 mb-4 text-center">Fluxo de ExecuÃ§Ã£o</h4>
            <div class="font-mono text-xs overflow-x-auto">
              <pre class="text-gray-400 leading-relaxed">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER MESSAGE                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  workflow_hygiene â†’ user_signal_node â†’ semantic_routing                      â”‚
â”‚  (TTL/Reset)         (Intent Extract)    (Embeddings &lt;10ms)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                       â”‚
           [Alta ConfianÃ§a]                        [Baixa ConfianÃ§a]
                    â”‚                                       â”‚
                    â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     BYPASS LLM (Fast Path)    â”‚       â”‚   structured_analysis_node (LLM)    â”‚
â”‚     ~40% das requests         â”‚       â”‚   Intent + Entities Extraction      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                         â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                          â”‚
   [pricing]                  [schedule/reschedule/cancel]    [information]
        â”‚                                                          â”‚
        â–¼                              â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ pricing_fast_lane â”‚   â”‚   BOOKING STATE MACHINE      â”‚   â”‚  agent_node  â”‚
â”‚ (Deterministic)   â”‚   â”‚   (FSM - 8 States)           â”‚   â”‚  (RAG/Tools) â”‚
â”‚ - RAG Search      â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚              â”‚
â”‚ - Cache Check     â”‚   â”‚   â”‚ detect â†’ discover_slots â”‚ â”‚   â”‚              â”‚
â”‚ - Direct Response â”‚   â”‚   â”‚ â†’ await_selection       â”‚ â”‚   â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚ â†’ await_confirmation    â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚             â”‚   â”‚ â†’ completed/handover    â”‚ â”‚          â”‚
          â”‚             â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚          â”‚
          â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
          â”‚                            â–¼                          â”‚
          â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
          â”‚             â”‚ booking_response_renderer    â”‚          â”‚
          â”‚             â”‚ (LLM Humanization)           â”‚          â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    sanitize_followup_node    â”‚
                        â”‚    (Guard + Format)          â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚      FINAL RESPONSE          â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
            </div>
          </div>

          <h3 class="text-xl font-semibold text-gray-200 mt-8 mb-4">LangGraph: Por que nÃ£o chains simples?</h3>

          <div class="bg-gray-900 rounded-lg overflow-hidden mb-6">
            <div class="bg-gray-800 px-4 py-2 text-sm text-gray-400 font-mono">graph_builder.py</div>
            <pre class="p-4 overflow-x-auto text-sm"><code class="text-gray-300"># LangGraph oferece controle granular sobre fluxo
graph = StateGraph(
    state_schema=ConversationState,  # Estado tipado
    context_schema=ContextSchema,    # Contexto injetado
)

# Conditional edges baseados em estado
graph.add_conditional_edges(
    "semantic_routing",
    lambda state: route_by_intent(state),  # FunÃ§Ã£o pura
    {
        "pricing": "pricing_fast_lane",
        "appointment": "booking_flow_router",
        "information": "agent_node",
        "greeting": "format_response",
    }
)

# RetryPolicy diferenciada por tipo de erro
retry_policy = RetryPolicy(
    max_attempts=3,
    initial_interval=0.5,
    backoff_factor=2.0,
    retry_on=TRANSIENT_EXCEPTIONS,  # SÃ³ transient!
)</code></pre>
          </div>

          <p class="text-gray-300 leading-relaxed">
            Chains sÃ£o lineares â€” entrada â†’ processamento â†’ saÃ­da. Booking flow precisa de 
            ramificaÃ§Ãµes complexas: usuÃ¡rio pode cancelar no meio de um reschedule, pedir 
            clarificaÃ§Ã£o, ou escalar para humano a qualquer momento. LangGraph permite 
            modelar isso como um grafo real.
          </p>
        </div>
      </section>

      <!-- Semantic Routing -->
      <section id="semantic-routing" class="mb-16">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
          <span class="w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center text-purple-400">ğŸ¯</span>
          Semantic Routing
        </h2>

        <div class="prose prose-invert max-w-none">
          <p class="text-gray-300 leading-relaxed mb-6">
            Antes de chamar o LLM para anÃ¡lise estruturada (caro, ~200ms), o Semantic Router 
            tenta classificar o intent via embeddings (barato, &lt;10ms). Se a confianÃ§a for 
            alta, bypassa o LLM completamente.
          </p>

          <div class="bg-gray-900 rounded-lg overflow-hidden mb-6">
            <div class="bg-gray-800 px-4 py-2 text-sm text-gray-400 font-mono">semantic_routing.py</div>
            <pre class="p-4 overflow-x-auto text-sm"><code class="text-gray-300">async def semantic_routing_node(state: dict, service: Any, config: Any):
    """
    Roteamento SemÃ¢ntico (Pre-LLM).
    
    1. Verifica flags Priority-0 (Booking/Handover) â†’ Se sim, ignora semantic
    2. Chama SemanticRouter.classify() via embeddings
    3. Se Alta ConfianÃ§a:
       a. Cria structured_analysis sintÃ©tico
       b. Valida via RoutingDecisionEngine (Policies/Circuit Breaker)
       c. Define routing_decision + fast_path_taken=True
    4. Se Baixa ConfianÃ§a: adiciona hints, segue para LLM
    """
    
    # Priority-0: estados determinÃ­sticos tÃªm prioridade absoluta
    pending_action = state.get("pending_action", "")
    if pending_action.startswith("confirm_"):
        # UsuÃ¡rio estÃ¡ confirmando algo - nÃ£o reclassificar
        return {"skip_semantic": True, "reason": "pending_confirmation"}
    
    # ClassificaÃ§Ã£o via embeddings (~7ms p95)
    result = await semantic_router.classify(
        text=user_message,
        hybrid_alpha=0.7,        # 70% embedding, 30% keyword
        abstain_threshold=0.55,  # Abaixo disso â†’ vai pro LLM
        bias_weight=0.03,        # Boost para intents prioritÃ¡rios
    )
    
    if result.confidence >= 0.85:
        # Alta confianÃ§a: bypass LLM
        return {
            "routing_decision": result.route,
            "fast_path_taken": True,
            "semantic_confidence": result.confidence,
        }
    else:
        # Baixa confianÃ§a: hints para o LLM
        return {
            "semantic_hints": result.top_routes,
            "fast_path_taken": False,
        }</code></pre>
          </div>

          <h3 class="text-xl font-semibold text-gray-200 mt-8 mb-4">Hybrid Alpha: Embeddings + Keywords</h3>

          <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-6 my-6">
            <p class="text-gray-400 mb-4">
              Embeddings puros falham em casos onde palavras-chave sÃ£o crÃ­ticas (ex: "cancelar" vs 
              "gostaria de remarcar"). O Semantic Router usa classificaÃ§Ã£o hÃ­brida:
            </p>
            <div class="font-mono text-sm bg-gray-800 rounded p-4">
              <span class="text-purple-400">score_final</span> = 
              <span class="text-emerald-400">0.7</span> Ã— embedding_similarity + 
              <span class="text-emerald-400">0.3</span> Ã— keyword_match
            </div>
            <p class="text-gray-500 text-sm mt-4">
              ConfigurÃ¡vel via env: <code>SEMANTIC_ROUTER_HYBRID_ALPHA=0.7</code>
            </p>
          </div>

          <div class="grid md:grid-cols-3 gap-4 my-6">
            <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-purple-400 mb-2">HYBRID_ALPHA</h4>
              <p class="text-sm text-gray-400">0.7 = 70% embeddings. Valores menores priorizam keywords.</p>
            </div>
            <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-purple-400 mb-2">ABSTAIN_THRESHOLD</h4>
              <p class="text-sm text-gray-400">0.55 = confianÃ§a mÃ­nima. Abaixo disso, passa pro LLM.</p>
            </div>
            <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-purple-400 mb-2">BIAS_WEIGHT</h4>
              <p class="text-sm text-gray-400">0.03 = boost para intents crÃ­ticos (booking > greeting).</p>
            </div>
          </div>

          <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-4 my-6">
            <h4 class="font-semibold text-green-400 mb-2">âœ“ Resultado</h4>
            <p class="text-sm text-gray-300">
              ~40% das requests sÃ£o classificadas com alta confianÃ§a e bypassam o LLM completamente. 
              Economia de ~$0.002/request Ã— 40% = reduÃ§Ã£o significativa de custo OpenAI.
            </p>
          </div>
        </div>
      </section>

      <!-- Booking FSM -->
      <section id="fsm" class="mb-16">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
          <span class="w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center text-blue-400">ğŸ”„</span>
          Booking State Machine
        </h2>

        <div class="prose prose-invert max-w-none">
          <p class="text-gray-300 leading-relaxed mb-6">
            O coraÃ§Ã£o do booking flow Ã© uma FSM (Finite State Machine) que define exatamente 
            quais transiÃ§Ãµes sÃ£o vÃ¡lidas. NÃ£o importa o que o LLM "ache" â€” se a transiÃ§Ã£o nÃ£o 
            estÃ¡ na tabela, nÃ£o acontece.
          </p>

          <!-- FSM Diagram -->
          <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-6 my-6">
            <h4 class="text-lg font-semibold text-gray-200 mb-4 text-center">Estados e TransiÃ§Ãµes</h4>
            <div class="font-mono text-xs overflow-x-auto">
              <pre class="text-gray-400 leading-relaxed">
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  detect  â”‚
                                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                   â–¼                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ discover_bookingâ”‚  â”‚ discover_slotsâ”‚  â”‚  clarification   â”‚
          â”‚ (busca existing)â”‚  â”‚ (busca slots) â”‚  â”‚ (pede detalhes)  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                   â”‚                   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                             â–¼                             â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
                   â”‚   await_selection   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ (mÃºltiplas opÃ§Ãµes)  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ await_confirmation  â”‚
                   â”‚ (usuÃ¡rio confirma)  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼               â–¼               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ completed â”‚  â”‚  handover  â”‚  â”‚ (back loop) â”‚
        â”‚ (sucesso) â”‚  â”‚ (humano)   â”‚  â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
            </div>
          </div>

          <h3 class="text-xl font-semibold text-gray-200 mt-8 mb-4">TransiÃ§Ãµes VÃ¡lidas (SSoT)</h3>

          <div class="bg-gray-900 rounded-lg overflow-hidden mb-6">
            <div class="bg-gray-800 px-4 py-2 text-sm text-gray-400 font-mono">booking_fsm_contract.py</div>
            <pre class="p-4 overflow-x-auto text-sm"><code class="text-gray-300"># Single Source of Truth para transiÃ§Ãµes
FSM_TRANSITIONS = {
    "detect": {
        "discover_booking",   # Buscar agendamento existente
        "discover_slots",     # Buscar horÃ¡rios disponÃ­veis
        "await_confirmation", # ConfirmaÃ§Ã£o direta
        "clarification",      # Pedir mais detalhes
        "handover",           # Escalar para humano
    },
    "discover_booking": {
        "await_selection",    # MÃºltiplos encontrados
        "discover_slots",     # Precisa de slots
        "await_confirmation", # Ãšnico encontrado
        "clarification",      # Precisa de detalhes
        "handover",
    },
    "discover_slots": {
        "await_selection",    # MÃºltiplos slots
        "await_confirmation", # Slot Ãºnico
        "clarification",
        "handover",
    },
    "await_selection": {
        "await_confirmation", # UsuÃ¡rio selecionou
        "discover_slots",     # Nova busca
        "discover_booking",   # Mudar booking
        "handover",
    },
    "await_confirmation": {
        "completed",          # âœ… ERP executado
        "discover_slots",     # UsuÃ¡rio mudou de ideia
        "discover_booking",
        "handover",
    },
    # Estados terminais
    "completed": {"completed", "handover"},
    "handover": {"handover"},
}

def is_valid_transition(from_state: str, to_state: str) -> bool:
    """Valida se transiÃ§Ã£o Ã© permitida."""
    return to_state in FSM_TRANSITIONS.get(from_state, set())</code></pre>
          </div>

          <h3 class="text-xl font-semibold text-gray-200 mt-8 mb-4">OperaÃ§Ãµes Suportadas</h3>

          <div class="grid md:grid-cols-3 gap-4 my-6">
            <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-blue-400 mb-2">schedule</h4>
              <p class="text-sm text-gray-400">Novo agendamento. Busca slots â†’ seleÃ§Ã£o â†’ confirmaÃ§Ã£o â†’ ERP create.</p>
            </div>
            <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-yellow-400 mb-2">reschedule</h4>
              <p class="text-sm text-gray-400">Remarcar existente. Busca booking â†’ slots â†’ confirmaÃ§Ã£o â†’ ERP update.</p>
            </div>
            <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-red-400 mb-2">cancel</h4>
              <p class="text-sm text-gray-400">Cancelar existente. Busca booking â†’ confirmaÃ§Ã£o â†’ ERP delete.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Context Composer -->
      <section id="context-composer" class="mb-16">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
          <span class="w-8 h-8 bg-cyan-500/20 rounded-lg flex items-center justify-center text-cyan-400">ğŸ“</span>
          Context Composer (ECA)
        </h2>

        <div class="prose prose-invert max-w-none">
          <p class="text-gray-300 leading-relaxed mb-6">
            O Context Composer implementa a Enhanced Context Architecture (ECA) â€” um sistema 
            de montagem de contexto determinÃ­stico que busca dados de mÃºltiplas fontes, aplica 
            budget de tokens, e formata em blocos ordenados para o LLM.
          </p>

          <div class="bg-gray-900 rounded-lg overflow-hidden mb-6">
            <div class="bg-gray-800 px-4 py-2 text-sm text-gray-400 font-mono">context_composer.py</div>
            <pre class="p-4 overflow-x-auto text-sm"><code class="text-gray-300">class ContextComposer:
    """
    Composes unified context from multiple sources.
    
    Sources:
    - Memory Engine (handover state, customer memory)
    - Tenant Config (identity, rules)
    - Conversation History
    
    Features:
    - Budget management (CONTEXT_BUDGET_TOKENS=1200)
    - Priority-based truncation
    - Block-based format (never cuts IDENTITY, RULES, INPUT)
    """
    
    def __init__(self):
        self.budget_tokens = int(os.getenv("CONTEXT_BUDGET_TOKENS", "1200"))
        self.memory_engine_url = os.getenv("MEMORY_ENGINE_URL")
    
    async def compose(
        self,
        tenant_id: str,
        conversation_id: str,
        user_id: str,
        message: str,
        tenant_config: dict,
        existing_history: list | None = None,
    ) -> ContextContractV1:
        """
        Compose full context with budget enforcement.
        
        Block Priority (never truncated):
        1. IDENTITY - quem Ã© o assistente
        2. RULES - regras de negÃ³cio do tenant  
        3. INPUT - mensagem do usuÃ¡rio
        
        Truncatable (em ordem de prioridade):
        4. MEMORY - memÃ³ria do cliente
        5. HANDOVER - contexto de handover
        6. FOCUS - contexto focado (RAG results)
        """
        # Fetch parallel (asyncio.gather)
        memory_ctx, handover_ctx = await asyncio.gather(
            self._fetch_memory(tenant_id, user_id),
            self._fetch_handover(tenant_id, conversation_id),
        )
        
        # Build identity from tenant config
        identity = self._build_identity(tenant_config)
        
        # Apply budget with priority truncation
        return self._apply_budget(
            identity=identity,
            memory=memory_ctx,
            handover=handover_ctx,
            message=message,
        )</code></pre>
          </div>

          <h3 class="text-xl font-semibold text-gray-200 mt-8 mb-4">Budget Management</h3>

          <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-6 my-6">
            <p class="text-gray-400 mb-4">
              Com contexto de 1200 tokens e mÃºltiplas fontes, Ã© fÃ¡cil estourar o budget. 
              O Context Composer usa truncation inteligente:
            </p>
            <ul class="space-y-2 text-gray-400">
              <li class="flex items-start gap-3">
                <span class="text-cyan-400 mt-1">1.</span>
                <span><strong class="text-gray-200">Blocos intocÃ¡veis:</strong> IDENTITY, RULES, INPUT nunca sÃ£o truncados</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-cyan-400 mt-1">2.</span>
                <span><strong class="text-gray-200">CompressÃ£o semÃ¢ntica:</strong> MEMORY pode ser comprimido (90% reduÃ§Ã£o via Memory Engine)</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-cyan-400 mt-1">3.</span>
                <span><strong class="text-gray-200">Truncation por prioridade:</strong> FOCUS (RAG) Ã© truncado primeiro se necessÃ¡rio</span>
              </li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Pricing Fast Lane -->
      <section id="fast-lane" class="mb-16">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
          <span class="w-8 h-8 bg-yellow-500/20 rounded-lg flex items-center justify-center text-yellow-400">âš¡</span>
          Pricing Fast Lane
        </h2>

        <div class="prose prose-invert max-w-none">
          <p class="text-gray-300 leading-relaxed mb-6">
            Consultas de preÃ§o sÃ£o o caso de uso mais comum (~35% das mensagens) e tÃªm um padrÃ£o 
            previsÃ­vel: busca RAG + formataÃ§Ã£o. O Pricing Fast Lane executa isso diretamente, 
            sem passar pelo agent_node (que faz iteraÃ§Ãµes LLM caras).
          </p>

          <div class="bg-gray-900 rounded-lg overflow-hidden mb-6">
            <div class="bg-gray-800 px-4 py-2 text-sm text-gray-400 font-mono">pricing_fast_lane.py</div>
            <pre class="p-4 overflow-x-auto text-sm"><code class="text-gray-300"># ==============================================================================
# ğŸ”§ NOTA SOBRE TOOL BUDGET (Tech Lead Review)
# ==============================================================================
# Este mÃ³dulo (pricing_fast_lane) NÃƒO estÃ¡ sujeito ao tool_budget porque:
# 1. Ã‰ um caminho OTIMIZADO que executa tool diretamente
# 2. Ã‰ DETERMINÃSTICO - nÃ£o entra em loop de iteraÃ§Ãµes
# 3. O tool_budget Ã© para controlar ITERAÃ‡Ã•ES do agente
# 4. Se o fast lane falha, termina sem handover
# ==============================================================================

async def pricing_fast_lane_node(state: dict, service: Any, config: Any):
    """
    Caminho otimizado para consultas de preÃ§o.
    
    Fluxo:
    1. Check cache (intelligent_cache_service)
    2. Se miss: RAG search via docling_semantic_search_tool
    3. Formata resposta diretamente (sem LLM)
    4. Retorna com fast_lane_executed=True
    """
    # Intelligent cache com coalescing
    cache_key = build_intelligent_cache_key(
        tenant_id=config.tenant_id,
        query_normalized=normalize_query(user_message),
    )
    
    cached = await get_or_compute_with_coalescing(
        key=cache_key,
        compute_fn=lambda: _do_rag_search(state, service),
        ttl_seconds=300,
    )
    
    if cached:
        return {
            "pricing_response": cached,
            "fast_lane_executed": True,
            "cache_hit": True,
        }
    
    # RAG search (deterministic)
    results = await docling_semantic_search(
        query=user_message,
        tenant_id=config.tenant_id,
        k=5,
        threshold=0.7,  # Adaptive threshold
    )
    
    # Format response (template-based, no LLM)
    response = format_pricing_response(results)
    
    return {
        "pricing_response": response,
        "fast_lane_executed": True,
    }</code></pre>
          </div>

          <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 my-6">
            <h4 class="font-semibold text-yellow-400 mb-2">âš¡ Resultado</h4>
            <p class="text-sm text-gray-300">
              Fast lane reduz latÃªncia de ~2s (agent iteration) para ~200ms (RAG direto). 
              Cache hit: &lt;50ms. Sem custo de tokens LLM para ~35% das requests.
            </p>
          </div>
        </div>
      </section>

      <!-- Booking Flow Reducer -->
      <section id="reducer" class="mb-16">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
          <span class="w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center text-green-400">ğŸ”’</span>
          Booking Flow Reducer
        </h2>

        <div class="prose prose-invert max-w-none">
          <p class="text-gray-300 leading-relaxed mb-6">
            O Reducer Ã© o guardiÃ£o do booking_flow state. Todo update passa por ele, que valida 
            whitelist de sources, monotonicity de turn_seq, e transiÃ§Ãµes vÃ¡lidas. Se algo violar 
            as invariantes, o update Ã© rejeitado.
          </p>

          <div class="bg-gray-900 rounded-lg overflow-hidden mb-6">
            <div class="bg-gray-800 px-4 py-2 text-sm text-gray-400 font-mono">booking_flow_reducer.py</div>
            <pre class="p-4 overflow-x-auto text-sm"><code class="text-gray-300"># Whitelist de sources permitidos
ALLOWED_UPDATERS = {
    "booking_flow_router",      # Main state machine router
    "discover_booking_node",    # Booking discovery (IO task)
    "discover_slots_node",      # Slot discovery (IO task)
    "confirm_booking",          # Confirm booking node
    "confirm_reschedule",       # Confirm reschedule node
    "confirm_cancel",           # Confirm cancel node
    "task_create_appointment",  # ERP mutation task
    "memory_engine_sync",       # Memory Engine persistence
    "workflow_hygiene",         # Workflow hygiene reset
}

class BookingFlowUpdate:
    """
    Validated booking_flow update with all constraints checked.
    
    Constraints:
    1. Whitelist validation (source must be in ALLOWED_UPDATERS)
    2. Monotonicity check (turn_seq >= current)
    3. Immutability guards (stage transitions must be valid)
    4. Automatic normalization (version++, updated_at)
    """
    
    def __init__(self, update: dict, current: dict, source: str):
        # Whitelist check
        if source not in ALLOWED_UPDATERS:
            booking_flow_rejections_total.labels(reason="unauthorized_source").inc()
            raise BookingFlowUpdateError(
                f"Source '{source}' not authorized to update booking_flow"
            )
        
        # Monotonicity check
        new_seq = update.get("turn_seq", 0)
        current_seq = current.get("turn_seq", 0)
        if new_seq < current_seq:
            booking_flow_rejections_total.labels(reason="out_of_order").inc()
            raise BookingFlowUpdateError(
                f"Out-of-order update: {new_seq} < {current_seq}"
            )
        
        # Transition validation
        new_stage = update.get("stage")
        current_stage = current.get("stage", "detect")
        if new_stage and not is_valid_transition(current_stage, new_stage):
            booking_flow_rejections_total.labels(reason="invalid_transition").inc()
            raise BookingFlowUpdateError(
                f"Invalid transition: {current_stage} â†’ {new_stage}"
            )</code></pre>
          </div>

          <h3 class="text-xl font-semibold text-gray-200 mt-8 mb-4">Por que Reducer?</h3>

          <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-6 my-6">
            <ul class="space-y-3 text-gray-400">
              <li class="flex items-start gap-3">
                <span class="text-green-400 mt-1">âœ“</span>
                <span><strong class="text-gray-200">Previne race conditions:</strong> MÃºltiplos nÃ³s podem tentar atualizar o state simultaneamente. Reducer serializa e valida.</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-green-400 mt-1">âœ“</span>
                <span><strong class="text-gray-200">Auditoria:</strong> Cada update Ã© logado com source, turn_seq, e transiÃ§Ã£o. Facilita debugging.</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-green-400 mt-1">âœ“</span>
                <span><strong class="text-gray-200">MÃ©tricas:</strong> Prometheus counters para updates e rejections por reason.</span>
              </li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Retry Policies -->
      <section id="retry" class="mb-16">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
          <span class="w-8 h-8 bg-orange-500/20 rounded-lg flex items-center justify-center text-orange-400">ğŸ”</span>
          Retry Policies
        </h2>

        <div class="prose prose-invert max-w-none">
          <p class="text-gray-300 leading-relaxed mb-6">
            Nem todo erro merece retry. Erros transientes (timeout, rate limit) sÃ£o retriÃ¡veis. 
            Erros permanentes (auth failure, bad request) nÃ£o sÃ£o â€” retry sÃ³ gasta tempo e dinheiro.
          </p>

          <div class="bg-gray-900 rounded-lg overflow-hidden mb-6">
            <div class="bg-gray-800 px-4 py-2 text-sm text-gray-400 font-mono">graph_builder.py</div>
            <pre class="p-4 overflow-x-auto text-sm"><code class="text-gray-300"># SOTA FIX (Dezembro 2025): Transient vs Permanent Exceptions

TRANSIENT_EXCEPTIONS = (
    httpx.TimeoutException,
    httpx.ConnectError,
    httpx.ReadTimeout,
    openai.APIConnectionError,
    openai.RateLimitError,       # RetriÃ¡vel com backoff
    openai.APITimeoutError,
    ConnectionError,
    TimeoutError,
    asyncio.TimeoutError,
)

# Permanent exceptions should NOT be retried
PERMANENT_EXCEPTIONS = (
    openai.AuthenticationError,   # API key invÃ¡lida
    openai.BadRequestError,       # Prompt malformado
    openai.PermissionDeniedError, # Sem permissÃ£o
    ValueError,
    TypeError,
    KeyError,
)

# RetryPolicy usa whitelist (retry_on), nÃ£o blacklist
retry_policy = RetryPolicy(
    max_attempts=3,
    initial_interval=0.5,         # 500ms
    backoff_factor=2.0,           # 500ms â†’ 1s â†’ 2s
    retry_on=TRANSIENT_EXCEPTIONS,
)</code></pre>
          </div>

          <div class="bg-orange-500/10 border border-orange-500/30 rounded-lg p-4 my-6">
            <h4 class="font-semibold text-orange-400 mb-2">âš ï¸ Por que whitelist e nÃ£o blacklist?</h4>
            <p class="text-sm text-gray-300">
              Blacklist Ã© perigosa: se um novo tipo de erro permanente aparecer (ex: nova exception 
              do OpenAI SDK), ele seria retriado por default. Whitelist Ã© fail-safe: sÃ³ retria o 
              que conhecemos como transiente.
            </p>
          </div>
        </div>
      </section>

      <!-- Results -->
      <section id="resultados" class="mb-16">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
          <span class="w-8 h-8 bg-emerald-500/20 rounded-lg flex items-center justify-center text-emerald-400">ğŸ“Š</span>
          Resultados
        </h2>

        <div class="grid md:grid-cols-2 gap-6">
          <div class="bg-gradient-to-br from-emerald-500/10 to-cyan-500/10 border border-emerald-500/20 rounded-lg p-6">
            <div class="text-3xl font-bold text-emerald-400 mb-2">~40%</div>
            <div class="text-gray-400">Requests bypassam LLM via Semantic Routing</div>
          </div>
          <div class="bg-gradient-to-br from-emerald-500/10 to-cyan-500/10 border border-emerald-500/20 rounded-lg p-6">
            <div class="text-3xl font-bold text-emerald-400 mb-2">&lt;10ms</div>
            <div class="text-gray-400">ClassificaÃ§Ã£o via embeddings (p95)</div>
          </div>
          <div class="bg-gradient-to-br from-emerald-500/10 to-cyan-500/10 border border-emerald-500/20 rounded-lg p-6">
            <div class="text-3xl font-bold text-emerald-400 mb-2">0</div>
            <div class="text-gray-400">TransiÃ§Ãµes invÃ¡lidas de FSM em produÃ§Ã£o</div>
          </div>
          <div class="bg-gradient-to-br from-emerald-500/10 to-cyan-500/10 border border-emerald-500/20 rounded-lg p-6">
            <div class="text-3xl font-bold text-emerald-400 mb-2">~200ms</div>
            <div class="text-gray-400">Pricing Fast Lane (vs ~2s agent)</div>
          </div>
        </div>

        <div class="bg-gray-900/50 border border-gray-800 rounded-lg p-6 mt-8">
          <h3 class="text-xl font-semibold text-gray-200 mb-4">DecisÃµes TÃ©cnicas Chave</h3>
          <ul class="space-y-3 text-gray-400">
            <li class="flex items-start gap-3">
              <span class="text-emerald-400 mt-1">â†’</span>
              <span><strong class="text-gray-200">FSM separada do LLM:</strong> DecisÃµes de negÃ³cio sÃ£o determinÃ­sticas. LLM sÃ³ humaniza.</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-emerald-400 mt-1">â†’</span>
              <span><strong class="text-gray-200">Semantic routing pre-LLM:</strong> ClassificaÃ§Ã£o barata antes de gastar tokens.</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-emerald-400 mt-1">â†’</span>
              <span><strong class="text-gray-200">Reducer com whitelist:</strong> SÃ³ sources autorizados atualizam estado crÃ­tico.</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-emerald-400 mt-1">â†’</span>
              <span><strong class="text-gray-200">Retry com whitelist:</strong> SÃ³ transient exceptions sÃ£o retriadas.</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-emerald-400 mt-1">â†’</span>
              <span><strong class="text-gray-200">Fast lanes para padrÃµes conhecidos:</strong> Pricing nÃ£o precisa de iteraÃ§Ã£o LLM.</span>
            </li>
          </ul>
        </div>
      </section>

      <!-- Tech Stack -->
      <section class="mb-16">
        <h2 class="text-2xl font-bold mb-6">Stack TÃ©cnico</h2>
        <div class="flex flex-wrap gap-2">
          <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded-full text-sm">Python 3.12</span>
          <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded-full text-sm">LangGraph</span>
          <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded-full text-sm">LangChain</span>
          <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded-full text-sm">FastAPI</span>
          <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded-full text-sm">OpenAI GPT-4</span>
          <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded-full text-sm">Embeddings</span>
          <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded-full text-sm">Redis</span>
          <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded-full text-sm">PostgreSQL</span>
          <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded-full text-sm">Prometheus</span>
          <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded-full text-sm">structlog</span>
        </div>
      </section>

      <!-- CTA -->
      <section class="border-t border-gray-800 pt-12">
        <div class="text-center">
          <h2 class="text-2xl font-bold mb-4">Explore Outros Case Studies</h2>
          <p class="text-gray-400 mb-8">Veja como outros componentes do Optimus foram construÃ­dos</p>
          <div class="flex flex-wrap justify-center gap-4">
            <NuxtLink to="/projetos/rules-engine" class="px-6 py-3 bg-gray-800 hover:bg-gray-700 text-gray-200 rounded-lg transition-colors">
              Rules Engine â†’
            </NuxtLink>
            <NuxtLink to="/projetos/memory-engine" class="px-6 py-3 bg-gray-800 hover:bg-gray-700 text-gray-200 rounded-lg transition-colors">
              Memory Engine â†’
            </NuxtLink>
            <NuxtLink to="/projetos/llm-pool-management" class="px-6 py-3 bg-gray-800 hover:bg-gray-700 text-gray-200 rounded-lg transition-colors">
              LLM Pool Management â†’
            </NuxtLink>
          </div>
        </div>
      </section>

    </main>

    <!-- Footer -->
    <footer class="border-t border-gray-800 py-8 mt-12">
      <div class="max-w-4xl mx-auto px-4 text-center text-gray-500 text-sm">
        <p>Case Study: AI Conversation Engine â€” Optimus AI Platform</p>
      </div>
    </footer>
  </div>
</template>

<script setup>
useHead({
  title: 'AI Conversation Engine - Optimus AI | Marcelo Marleta',
  meta: [
    { name: 'description', content: 'Case study: Motor de conversaÃ§Ã£o enterprise com LangGraph, FSM de 8 estados, Semantic Routing sub-10ms, e separaÃ§Ã£o entre lÃ³gica determinÃ­stica e linguagem natural.' }
  ]
})
</script>
